# Verified Mutable Map in Scala

This project contains a verified implementation of the `LongMap` from the scala standard library.

## Setup

To run this project, you need to install the Stainless sbt plugin. To do so, follow these steps:

1. Download the following archive: [Stainless SBT plugin download]("https://github.com/epfl-lara/stainless/releases/download/v0.9.8.2/sbt-stainless.zip")
2. Unzip the archive, it should contain a `project` folder and a `stainless` folder.
3. copy the `project/lib` folder into the `project` of this sbt project.
4. copy the `stainless` folder into the root of this sbt project.

You should obtain the following folder structure:

```
mutablemaps
├── build.sbt
├── project
│   ├── build.properties
│   └── lib                     <--------
│       └── sbt-stainless.jar   <--------
├── sbt-stainless.zip
├── src/
└── stainless/                  <--------
```

Now the project is ready to run, both the main class and the benchmarks.

If it does not work, please refer to [this manual]("https://epfl-lara.github.io/stainless/installation.html#usage-within-an-existing-project").

## Benchmarks

To run benchmarks, run in `sbt`

```$ Jmh/run -i 10 -wi 10 -f1 -t1 <regex-if-only-some>```

## Verification

To verify using Stainless, first install Stainless following the instructions [here]("github.com/epfl-lara/stainless"). Please note that the external solvers such as z3 and cvc5 must be installed separately and accessible in the `PATH`.

Then, run `$ ./verify.sh`.

### SMT queries

The SMT queries generated by Stainless during the verification of the `MutableLongMap` and `ListLongMap` with cache DISABLED are available on the repository [epfl-lara/LongMap-SMT-queries on GitHub]("https://github.com/epfl-lara/LongMap-SMT-queries"). The file `VCs_summary_nocache.csv` contains the list of the VCs with the following columns:

- `SMT Query ID`: The ID of the corresponding SMT-lib file in the `smt-queries-longmap` folder.
- `Position`: The position of the corresponding line in the source code.
- `Function`: The name of the function the VC corresponds to.
- `VC Details`: The details of what the VC verifies.
- `Validity`: The validity of the VC, either `valid`, or `trivial`. `trivial` means the VC is trivially valid after being simplified by Stainless' simplifier, without being sent to an SMT solver.
- `Solver`: The SMT solver that verified the VC the quickest among `z3`, `cvc4`, and `cvc5`.
- `Solving Time (sec)`: The time required to solve the VC by the solver in seconds.


## Run Main

To run the main class, run in `sbt`

```$ runMain ch.epfl.map.Main```
